######################
# VirtualBox settings
######################
# 12GB virtual disk image
# 2048MB memory
# 2 cpu cores
# bridged network adapter in promiscuous mode
# machine folder to 'workspaces/'

######################
# install everything
######################
sudo apt-get update
sudo apt-get upgrade
sudo apt-get install\
linux-headers sudo gcc g++ make gdb valgrind git\
bison flex libgmp-dev libmpfr-dev libmpc-dev\
qemu grub xorriso tftpd-hpa tftp-hpa udhcpd

######################
# fuck virtualbox, just mount the smb share as below
######################
mkdir /home/austin/workspaces
sudo echo //192.168.1.40/Workspaces	/home/austin/workspaces	cifs	uid=austin,username=austin,password=passwordhere,iocharset=utf8,sec=ntlm	0	0 >> /etc/fstab
sudo mount -a

######################
# cross compiler
# http://wiki.osdev.org/GCC_Cross-Compiler
######################
##### grab & extract the sources #####
wget ftp://ftp.gnu.org/gnu/binutils/binutils-2.25.tar.gz
wget ftp://ftp.gnu.org/gnu/gcc/gcc-4.9.2/gcc-4.9.2.tar.gz
tar -xf binutils-2.25.tar.gz
tar -xf gcc-4.9.2.tar.gz

##### set environment variables #####
export PREFIX="$HOME/opt/cross"
export TARGET=i686-elf
export PATH="$PREFIX/bin:$PATH"

##### compile binutils #####
mkdir build-binutils
cd build-binutils
../binutils-x.y.z/configure --target=$TARGET --prefix="$PREFIX" --with-sysroot --disable-nls --disable-werror
make
make install
cd ..

##### compile gcc #####
mkdir build-gcc
cd build-gcc
../gcc-x.y.z/configure --target=$TARGET --prefix="$PREFIX" --disable-nls --enable-languages=c,c++ --without-headers
make all-gcc
make all-target-libgcc
make install-gcc
make install-target-libgcc
cd ..

######################
# setup dhcp and tftp
######################
#  /etc/udhcpd.conf
#    siaddr     192.168.1.43
#    sname      eos
#    boot_file  /boot/grub/i386-pc/core.0
#  /etc/default/udhcpd
#    DHCPD_ENABLED="yes"
#  /etc/default/tftpd-hpa
#    TFTP_DIRECTORY="/home/austin/tftp_dir"
#    TFTP_ADDRESS="192.168.1.43:69"
sudo service udhcpd restart
sudo service tftpd-hpa restart

##### shared drive #####
/etc/fstab
//192.168.1.40/Storage/workspaces	/home/austin/workspaces	cifs	uid=austin,username=austin,password=xxxx,file_mode=0644,iocharset=utf8,sec=ntlm	0	0

example fstab entry
//server/user /mnt/share cifs user=user,uid=1000,gid=1000,domain=DOMAIN,rw,username=user,password=password,file_mode=0777,dir_mode=0777,_netdev 0 0
